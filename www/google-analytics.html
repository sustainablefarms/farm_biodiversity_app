<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-2YJP12Y16C"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-2YJP12Y16C', {cookie_flags: 'SameSite=None;Secure'});

$(document).ready(function(){
  $("#hidestartpage").on('click', function(e) {
      gtag('event', 'start', {
                              'event_category': 'button',
                              'event_label': $(this).attr("id")});
  });
  $("#in1_next").on('click', function(e) {
      gtag('event', 'to_pred1', {
                              'event_category': 'button',
                              'event_label': $(this).attr("id")});
  });
  $("#in2_next").on('click', function(e) {
      gtag('event', 'to_pred2', {
                              'event_category': 'button',
                              'event_label': $(this).attr("id")});
  });
  
  $("#pred1-downloaddata").on('click', function(e) {
      gtag('event', 'pred1_ downloadcsv', {
                              'event_category': 'download',
                              'event_label': $(this).attr("id")});
  });
  $("#pred2-downloaddata_rel").on('click', function(e) {
      gtag('event', 'pred2_downloadcsv', {
                              'event_category': 'download',
                              'event_label': $(this).attr("id")});
  });
  $("#out1_product").on('click', function(e) {
      gtag('event', 'pred1_downloadreport', {
                              'event_category': 'download',
                              'event_label': $(this).attr("id")});
  });
  
  $("#out2_product").on('click', function(e) {
      gtag('event', 'pred2_downloadreport', {
                              'event_category': 'download',
                              'event_label': $(this).attr("id")});
  });
  
});

// the fetching of woody canopy needs special handling as too many other buttons and is only generated part way through page interaction. (Selecting by id doesn't seem to work in the childSelector argument of 'on'). There is matching message sender in the patch attribute module
Shiny.addCustomMessageHandler('getwoodycanopyfromlatlon', function(nothing) {
      gtag('event', 'getlatlonfromsatellite', {
                              'event_category': 'button',
                              'event_label': 'getlatlonfromsatellite'
      });
});

// So does server-side calculation of predictions
Shiny.addCustomMessageHandler('predictionsmade', function(nothing) {
      gtag('event', 'predictionsmade', {
                              'event_category': 'server',
                              'event_label': 'predictionsmade'
      });
});

//the following search for 'a' objects with the right start to the hyperref
  $(document).on('click', "a[href^='https://birdlifephotography.org.au']", function(){
      gtag('event', 'link_birdlifephotography', {
                              'event_category': 'outbound_link',
                              'event_label': 'to_birdlife_photography',
                              'label' : $(this).attr("href")
      });
  });
  
  
  $(document).on('click', "a[href^='https://birdlife.org.au']", function(){
      gtag('event', 'link_birdlifeprofile', {
                              'event_category': 'outbound_link',
                              'event_label': 'to_birdlife_profile',
                              'label' : $(this).attr("href")
      });
  });
  
  
  $(document).on('click', "a[href='http://anuwald.science/tree']", function(){
      gtag('event', 'link_waldtree', {
                              'event_category': 'outbound_link',
                              'event_label': 'to_wald_tree',
                              'label' : $(this).attr("href")
      });
  });

</script>

